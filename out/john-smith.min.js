var js=js||{},JohnSmith;
(function(e){(function(c){var e=function(){function c(){this.items=[]}c.prototype.getAt=function(b){return this.items[b]};c.prototype.setAt=function(b,f){this.items[b]=f};c.prototype.removeAt=function(b){this.items.splice(b,1)};c.prototype.insertAt=function(b,f){this.items.splice(b,0,f)};c.prototype.add=function(b){this.items.push(b)};c.prototype.count=function(){return this.items.length};c.prototype.clear=function(){this.items.length=0};return c}();c.ArrayList=e;c.log={info:function(c){},warn:function(c){},
error:function(c){}};js.ioc={resolve:function(c){return this[c]},register:function(c,b){this[c]=b}}})(e.Common||(e.Common={}))})(JohnSmith||(JohnSmith={}));var __extends=this.__extends||function(e,c){function g(){this.constructor=e}g.prototype=c.prototype;e.prototype=new g};
(function(e){(function(c){(function(a){a._map=[];a._map[0]="replace";a.replace=0;a._map[1]="add";a.add=1;a._map[2]="remove";a.remove=2})(c.DataChangeReason||(c.DataChangeReason={}));var g=c.DataChangeReason,l=function(){function a(a,k){this.bindable=a;this.handler=k}a.prototype.init=function(){this.handler.wireWith(this.bindable)};a.prototype.dispose=function(){this.handler.unwireWith(this.bindable);this.handler.dispose()};a.prototype.getBindable=function(){return this.bindable};a.prototype.getHandler=
function(){return this.handler};return a}();c.BindingWire=l;var b=function(){function a(){this.listeners=new e.Common.ArrayList}a.prototype.getValue=function(){return this.value};a.prototype.setValue=function(a){this.notifyListeners(a,g.replace);this.value=a};a.prototype.getState=function(){return this.state};a.prototype.setState=function(a){for(var k=0;k<this.listeners.count();k++)this.listeners.getAt(k).stateChanged(this.state,a);this.state=a};a.prototype.addListener=function(a){this.listeners.add(a)};
a.prototype.removeListener=function(a){for(var k=-1,d=0;d<this.listeners.count();d++)this.listeners.getAt(d)==a&&(k=d);0<=k&&this.listeners.removeAt(k)};a.prototype.getListenersCount=function(){return this.listeners.count()};a.prototype.notifyListeners=function(a,k){for(var d=0;d<this.listeners.count();d++)this.listeners.getAt(d).valueChanged(this.value,a,k)};return a}();c.BindableValue=b;var f=function(a){function h(){a.call(this);a.prototype.setValue.call(this,[])}__extends(h,a);h.prototype.setValue=
function(h){if(h&&!(h instanceof Array))throw Error("Bindable list supports only array values");a.prototype.setValue.call(this,h)};h.prototype.add=function(){for(var h=[],d=0;d<arguments.length-0;d++)h[d]=arguments[d+0];for(var d=this.getValue(),b=0;b<h.length;b++)d.push(h[b]);a.prototype.notifyListeners.call(this,h,g.add)};h.prototype.remove=function(){for(var h=[],d=0;d<arguments.length-0;d++)h[d]=arguments[d+0];for(var d=this.getValue(),b=0;b<h.length;b++){for(var f=-1,c=0;c<d.length;c++)d[c]==
h[b]&&(f=c);0<=f&&d.splice(f,1)}a.prototype.notifyListeners.call(this,h,g.remove)};return h}(b);c.BindableList=f;var s=function(){function a(a){this.value=a}a.prototype.getValue=function(){return this.value};a.prototype.getState=function(){return"normal"};a.prototype.addListener=function(a){};a.prototype.removeListener=function(a){};return a}();c.StaticBindableValue=s;var t=function(){function a(a,b,d){this.bindableFactories=a;this.handlerFactories=b;this.handlerDataTransformers=d}a.prototype.bind=
function(a,b,d){a=this.getBindable(a);b=this.getHandler(b,d);return new l(a,b)};a.prototype.getBindable=function(a){for(var b=0;b<this.bindableFactories.count();b++){var d=this.bindableFactories.getAt(b).createBindable(a);if(null!=d)return d}throw Error("Could not transform object "+a+" to bindable");};a.prototype.getHandler=function(a,b){for(var d=a,f=0;f<this.handlerDataTransformers.count();f++)d=this.handlerDataTransformers.getAt(f).transform(d),e.Common.log.info(d);for(f=0;f<this.handlerFactories.count();f++){var c=
this.handlerFactories.getAt(f).createHandler(d,b);if(c)return c}throw Error("Could not transform object "+a+" to bindable handler");};return a}();c.DefaultBindingManager=t;var u=function(){function a(a,b){this.contentDestination=a;this.valueRenderer=b}a.prototype.wireWith=function(a){this.doRender(a.getValue());a.addListener(this)};a.prototype.unwireWith=function(a){a.removeListener(this)};a.prototype.valueChanged=function(a,b,d){this.doRender(b)};a.prototype.stateChanged=function(a,b){};a.prototype.dispose=
function(){this.valueRenderer.dispose&&this.valueRenderer.dispose()};a.prototype.doRender=function(a){this.valueRenderer.render(a,this.contentDestination)};return a}();c.RenderValueHandler=u;var n=function(){function a(a,b){this.contentDestination=a;this.valueFormatter=b}a.prototype.wireWith=function(a){this.doRender(a.getValue(),g.replace);a.addListener(this)};a.prototype.unwireWith=function(a){a.removeListener(this)};a.prototype.valueChanged=function(a,b,d){this.doRender(b,d)};a.prototype.stateChanged=
function(a,b){};a.prototype.dispose=function(){this.valueFormatter.dispose&&this.valueFormatter.dispose()};a.prototype.doRender=function(a,b){if(a)if(b==g.remove)for(var d=0;d<a.length;d++)this.contentDestination.remove(a[d]);else b!=g.add&&this.contentDestination.empty(),this.appendItems(a)};a.prototype.appendItems=function(a){for(var b=0;b<a.length;b++){var d=a[b],f=this.valueFormatter.format(d);this.contentDestination.append(d,f)}};return a}();c.RenderListHandler=n;var p=function(){function a(){for(var a=
[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0];this.items=new e.Common.ArrayList;for(b=0;b<a.length;b++)this.items.add(a[b])}a.prototype.wireWith=function(a){a.addListener(this)};a.prototype.unwireWith=function(a){a.removeListener(this)};a.prototype.valueChanged=function(a,b,d){};a.prototype.stateChanged=function(a,b){for(var d=0;d<this.items.count();d++){var f=this.items.getAt(d);f.isMatched(a,b)&&f.handle(a,b)}};a.prototype.dispose=function(){this.items.clear()};return a}();c.StateTransitionHandler=
p;p=function(){function a(){}a.prototype.createHandler=function(a,b){if(!a)return null;var d=a;if(!d.handler||"render"!=d.handler)return null;if(!d.contentDestination)throw Error("Required option 'contentDestination' is not set!");if(!d.renderer)throw Error("Required option 'renderer' is not set!");return a=new u(d.contentDestination,d.renderer)};return a}();c.RenderValueFactory=p;var v=function(){function a(){}a.prototype.createHandler=function(a,b){if(!a)return null;var d=a;if(!d.handler||"list"!=
d.handler)return null;null==d.valueFormatter&&(d.valueFormatter={format:function(a){return a}});return a=new n(d.contentDestination,d.valueFormatter)};return a}();c.RenderListFactory=v;var w=function(){function a(a,b,d){this.manager=a;this.bindable=b;this.context=d}a.prototype.to=function(a){this.manager.bind(this.bindable,a,this.context).init();return this};return a}();c.BindingConfig=w;c=function(){function a(){}a.prototype.createBindable=function(a){return new s(a)};return a}();var y=function(){function a(){}
a.prototype.createBindable=function(a){return a&&a.getValue&&a.addListener?a:null};return a}(),q=new e.Common.ArrayList,m=new e.Common.ArrayList,r=new e.Common.ArrayList;m.add(new v);m.add(new p);m.add({createHandler:function(a,b){return a&&a.wireWith&&a.unwireWith?a:null}});q.add(new y);q.add(new c);var x=new t(q,m,r);js.ioc.register("bindingManager",x);js.getBindableFactories=function(){return q};js.getHandlerFactories=function(){return m};js.getHandlerDataTransformers=function(){return r};js.addHandlerFactory=
function(a){m.insertAt(0,a)};js.addHandlerTransformer=function(a,b){"undefined"===typeof b&&(b=!1);b?r.insertAt(0,a):r.add(a)};js.bindableValue=function(){return new b};js.bindableList=function(){return new f};js.bind=function(a){return new w(x,a,null)};js.addHandlerTransformer({description:"{} => {handler: 'render'} [Sets handler to 'render' if it is not set]",transform:function(a,b){a&&"object"===typeof a&&!a.handler&&(a.handler="render");return a}});js.addHandlerTransformer({description:"{handler: 'render'} => {formatter: IValueFormatter} [Sets default formatter]",
transform:function(a,b){a&&("object"===typeof a&&a.handler&&"render"===a.handler)&&(!a.formatter&&!a.renderer)&&(a.formatter={format:function(a){return a}});return a}});js.addHandlerTransformer({description:"{formatter: IValueFormatter} => {renderer: IValueRenderer} [Converts value formatter to value renderer]",transform:function(a,b){if(a&&"object"===typeof a&&a.handler&&"render"===a.handler&&a.formatter&&!a.renderer){var f=a.formatter;a.renderer={render:function(a,b){b.empty();b.append(f.format(a))}};
f.dispose&&(a.renderer.dispose=function(){f.dispose})}return a}})})(e.Binding||(e.Binding={}))})(JohnSmith||(JohnSmith={}));
(function(e){(function(c){var g=function(){function b(b,c,e,g,n){this.bindableManager=b;this.elementFactory=c;this.templateQuery=e;this.initCallback=g;this.viewModel=n}b.prototype.renderTo=function(b){var c=this.elementFactory.createElement(this.templateQuery);b="string"==typeof b?this.elementFactory.createElement(b):b;c=c.getHtml();b.empty();this.rootElement=b.append(c);this.initCallback(this,this.viewModel);this.viewModel.resetState&&this.viewModel.resetState()};b.prototype.bind=function(b){return new e.Binding.BindingConfig(this.bindableManager,
b,this.rootElement)};b.prototype.dispose=function(){};return b}();c.DefaultView=g;var l=function(){function b(b){this.viewFactory=b}b.prototype.render=function(b,c){this.currentView&&this.currentView.dispose();b&&(this.currentView=this.viewFactory(b),this.currentView.renderTo(c))};b.prototype.dispose=function(){this.currentView&&this.currentView.dispose()};return b}();c.ViewValueRenderer=l;js.addHandlerTransformer({description:"{view: Function} => {renderer: IValueRenderer} [Sets renderer for view]",
transform:function(b,c){b&&("render"===b.handler&&b.view)&&(b.renderer=new l(b.view));return b}});js.createView=function(b,c,e){return new g(js.ioc.resolve("bindingManager"),js.ioc.resolve("elementFactory"),b,c,e)}})(e.Views||(e.Views={}))})(JohnSmith||(JohnSmith={}));
(function(e){(function(c){var g=function(){function b(){}b.prototype.createHandler=function(b,c){js.ioc.resolve("elementFactory");b&&(b.handler&&b.to&&"list"==b.handler)&&(b.contentDestination={empty:function(){$(b.to).empty()},append:function(c,e){$(e).data("dataItem",c).addClass("dataItem").appendTo($(b.to))},remove:function(c){var e=[];$(b.to).find(".dataItem").each(function(b,f){var g=$(f);g.data("dataItem")==c&&e.push(g)});for(var g=0;g<e.length;g++)e[g].remove()}});return null};return b}();
c.JQueryBindableHandlerTransformer=g;var l=function(){function b(b){this.target=b}b.prototype.empty=function(){this.target.empty()};b.prototype.append=function(c){c=$($.parseHTML(c));this.target.append(c);return new b(c)};b.prototype.getHtml=function(){return this.target.html()};b.prototype.findRelative=function(c){var e=this.target.filter(c);0==e.length&&(e=this.target.find(c));return new b(e)};return b}();js.addHandlerTransformer({description:"{to: 'selector'} => {contentDestination: IElement} [Converts 'to' selector to DOM element]",
transform:function(b,c){if(b&&b.handler&&"render"===b.handler&&b.to){var e=js.ioc.resolve("elementFactory");b.contentDestination=null==c?e.createElement(b.to):c.findRelative(b.to)}return b}},!0);js.addHandlerTransformer({description:"'selector' => {to: 'selector', handler: 'render'} [Handles selector and converts it to object with 'to' property]",transform:function(b,c){return"string"==typeof b?{to:b,handler:"render"}:b}},!0);js.addHandlerFactory(new e.JQuery.JQueryBindableHandlerTransformer);js.ioc.register("elementFactory",
{createElement:function(b){return new l($(b))},createRelativeElement:function(b,c){}})})(e.JQuery||(e.JQuery={}))})(JohnSmith||(JohnSmith={}));
