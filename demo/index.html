<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="styles/bootstrap.min.css" />
    <link rel="stylesheet" href="styles/idea.css" />

    <style type="text/css">
        header
        {
            padding-bottom: 30px;
        }

        .example
        {
            padding-bottom: 30px;
        }
    </style>

    <title>JohnSmith Usage Cases</title>
</head>
<body>
    <div class="container">
        <header>
            <h1>JohnSmith</h1>
        </header>
        <div id="examples"></div>
    </div>


    <script type="text/javascript" src="scripts/jquery-2.0.0.min.js"></script>
    <script type="text/javascript" src="scripts/highlight.pack.js"></script>

    <script type="text/javascript" src="../src/Common.js"></script>
    <script type="text/javascript" src="../src/Binding.js"></script>
    <script type="text/javascript" src="../src/Config.js"></script>
    <script type="text/javascript" src="../src/JQuery.js"></script>

    <script type="text/javascript">
        var examples = [
            {
                id: "binding_basicUsage_staticValue",
                title: "Static value binding",
                description: "Demonstrates simple binding to a static value.",
                html: "<div class='fullName'></div>",
                src: function () {
                    js.bind("John Smith").to("#binding_basicUsage_staticValue .fullName");
                }
            },
            {
                id: "binding_basicUsage_dynamicValue",
                title: "Dynamic value binding",
                description: "Demonstrates simple binding to a dynamic value (current time).",
                html: "<div class='currentTime'></div>",
                src: function () {
                    var currentTime = js.bindableValue();
                    currentTime.setValue("...");

                    window.setInterval(function(){
                        currentTime.setValue(new Date().toLocaleTimeString());
                    }, 1000);

                    js.bind(currentTime).to("#binding_basicUsage_dynamicValue .currentTime");
                }
            },
            {
                id: "binding_simpleList_customFormatting",
                title: "List binding",
                description: "Demonstrates custom item formatter usage for list binding.",
                html: "<ul id='people'></ul>",
                src: function () {
                    var people = js.bindableList();

                    js.bind(people).to({
                        handler: "list",
                        to: "#people",
                        valueFormatter: {
                            format: function(value){
                                return $("<li class='person'></li>").text(value);
                            }
                        }
                    });

                    people.setValue(["John Smith", "Marilyn Manson"]);
                }
            },
            {
                id: "binding_simpleList_interaction",
                title: "List binding interaction",
                description: "Demonstrates using add/remove methods of bindable list. Note that you can add or remove multiple items at one call.",
                html: "<ul id='employee'></ul>",
                src: function () {
                    var employee = js.bindableList();

                    js.bind(employee).to({
                        handler: "list",
                        to: "#employee",
                        valueFormatter: {
                            format: function(value){
                                return $("<li class='person'></li>").text(value);
                            }
                        }
                    });

                    employee.add("Joe Bloggs", "Fred Bloggs", "Bob Soap");
                    employee.add("Charlie Farnsbarns");
                    employee.add("John Q. Public");
                    employee.add("Joe Public");

                    employee.remove("Fred Bloggs", "John Q. Public");
                }
            },
            {
                id: "view_simple",
                title: "Simple vew",
                description: "Demonstrates simple view rendering.",
                html: "<div class='person'><span class='firstName'></span><span class='lastName'></span></div>",
                src: function () {
                    var viewModel = {
                        firstName: "John",
                        lastName: "Smith"
                    };

                    var view = js.createView(
                        "#personTemplate",
                        function(){

                        },
                        viewModel);

                    view.renderTo();
                }
            }
        ];

        function getCodeSnippet(example) {
            var sanitizedCode = example.src.toString().replace(/.*{/, "").replace(/.*}$/, "");
            var lines = sanitizedCode.split(/\r\n|\r|\n/g);
            if (lines.length <= 2){
                return "";
            }

            lines.splice(0, 1); // remove the first line;

            var firstLine = lines[0];
            var spaceCount = getSpaceCount(firstLine);

            for (var index = 0; index < lines.length; index++){
                var line = lines[index];
                console.log(line);

                lines[index] = sanitizeLine(line, spaceCount);

                console.log(lines[index]);
            }

            return  lines.join("\r\n");
        }

        function sanitizeLine(line, spaceCount){
            for (var i = 0; i < spaceCount; i++){
                if (line.length == 0){
                    return line;
                }

                if (line[0] == " "){
                    line = line.substr(1, line.length - 1);
                } else {
                    return line;
                }
            }

            return line;
        }

        function getSpaceCount(line){
            var spaceCount = 0;

            for(var i = 0; i < line.length; i++){
                if (line[i] == " "){
                    spaceCount++;
                } else {
                    return spaceCount;
                }
            }

            return spaceCount;
        }

        $(function(){
            for (var i = 0; i < examples.length; i++) {
                var example = examples[i];

                var $html = $("<div class='content'/>").html(example.html);
                var $htmlSample = $("<div class='html'><pre><code></code></pre></div>");
                var $code = $("<div class='code'><pre><code class='javascript'></code></pre></div>");

                $code.find("code").text(getCodeSnippet(example));
                $htmlSample.find("code").text(example.html);

                $("<div class='example'/>")
                        .attr("id", example.id)
                        .append("<h2>" + example.title + "</h2>")
                        .append("<p>" + example.description + "</p>")
                        .append("<h5>Javascript</h5>")
                        .append($code)
                        .append("<h5>HTML</h5>")
                        .append($htmlSample)
                        .append("<h5>Result</h5>")
                        .append($html)

                        .appendTo("#examples");

                example.src();
            }
        });


        hljs.initHighlightingOnLoad();
    </script>
</body>
</html>